{% extends "layout.html" %}
{% block title %}System Monitor{% endblock %}
{% block main %}
<div class="container mt-4">
    <h1 class="text-light mb-4">System Monitor</h1>

    <div class="row">
        <!-- CPU Usage Card -->
        <div class="col-md-4 mb-4">
            <div class="card bg-dark text-light">
                <div class="card-body">
                    <h5 class="card-title">CPU Usage</h5>
                    <p class="card-text display-4" id="cpu-usage">0%</p>
                    <p class="card-text">Peak: <span id="cpu-peak">0%</span></p>
                </div>
            </div>
        </div>

        <!-- Memory Usage Card -->
        <div class="col-md-4 mb-4">
            <div class="card bg-dark text-light">
                <div class="card-body">
                    <h5 class="card-title">Memory Usage</h5>
                    <p class="card-text display-4" id="memory-usage">0 MB</p>
                    <p class="card-text">Peak: <span id="memory-peak">0 MB</span></p>
                </div>
            </div>
        </div>

        <!-- Disk I/O Card -->
        <div class="col-md-4 mb-4">
            <div class="card bg-dark text-light">
                <div class="card-body">
                    <h5 class="card-title">Disk I/O</h5>
                    <p class="card-text">Read: <span id="disk-read">0 MB</span></p>
                    <p class="card-text">Write: <span id="disk-write">0 MB</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Analysis -->
    <div class="card bg-dark text-light mt-4">
        <div class="card-body">
            <h5 class="card-title">Performance Analysis</h5>
            <div id="analysis-content"></div>
        </div>
    </div>
</div>

<script>
function updateMetrics() {
    fetch('/system-metrics')
        .then(response => response.json())
        .then(data => {
            document.getElementById('cpu-usage').textContent = data.cpu_percent + '%';
            document.getElementById('cpu-peak').textContent = data.peak_metrics.cpu + '%';
            document.getElementById('memory-usage').textContent = Math.round(data.memory_rss) + ' MB';
            document.getElementById('memory-peak').textContent = Math.round(data.peak_metrics.memory) + ' MB';
            document.getElementById('disk-read').textContent = Math.round(data.disk_read_mb) + ' MB';
            document.getElementById('disk-write').textContent = Math.round(data.disk_write_mb) + ' MB';

            // Update analysis
            const analysis = data.analysis;
            if (analysis) {
                let analysisHtml = '';
                for (const [key, value] of Object.entries(analysis)) {
                    if (typeof value === 'object') {
                        analysisHtml += `<h6 class="mt-3">${key}</h6>`;
                        for (const [subKey, subValue] of Object.entries(value)) {
                            analysisHtml += `<p>${subKey}: ${subValue}</p>`;
                        }
                    }
                }
                document.getElementById('analysis-content').innerHTML = analysisHtml;
            }
        });
}

// Update metrics every second
setInterval(updateMetrics, 1000);
updateMetrics(); // Initial update
</script>

<style>
.card {
    border: 1px solid #86C232;
}
.card-title {
    color: #86C232;
}
.display-4 {
    color: #61892F;
}
</style>
{% endblock %}