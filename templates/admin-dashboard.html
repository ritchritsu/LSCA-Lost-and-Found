{% extends "layout.html" %}
{% block title %}
    Admin Dashboard
{% endblock %}

{% block main %}
<div class="container mt-4">
    <h1 class="text-light">SHS Item Record</h1>
    <div id="table-container" class="table-responsive" style="width: 80vw; overflow-y: auto; margin-left: -5em;"></div> <!-- Div for Tabulator -->
</div>

<!-- Include Tabulator CDN -->
<link rel="stylesheet" href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css">
<script src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>

<!-- Custom CSS for Tabulator -->
<style>
    .tabulator .tabulator-tableHolder .tabulator-table {
        background-color: rgba(128, 128, 128, 0.5) !important; /* Transparent gray background */
        color: #000000 !important; /* Black text */
        font-weight: bold !important; /* Bold text */
    }

    .custom-green-btn {
        background-color: #087830;
        border-color: #087830;
        color: white;
    }

    .custom-green-btn:hover {
        background-color: #065a2b;
        border-color: #065a2b;
    }

    .custom-nav-link {
        color: #ffffff !important;
        position: relative;
        text-decoration: none;
        transition: color 0.2s ease-in-out;
    }

    .custom-nav-link::after {
        content: '';
        position: absolute;
        width: 0;
        height: 2px;
        display: block;
        margin-top: 5px;
        right: 0;
        background: #ffffff;
        transition: width 0.2s ease-in-out;
        -webkit-transition: width 0.2s ease-in-out;
    }

    .custom-nav-link:hover::after {
        width: 100%;
        left: 0;
        background: #ffffff;
    }

    .custom-nav-link:hover {
        color: #ffffff;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const tableData = JSON.parse(`{{ items | tojson | safe }}`); // Flask data

    const table = new Tabulator("#table-container", {
        data: tableData,
        layout: "fitColumns",
        columns: [
            { title: "ID", field: "id", width: 50, headerFilter: true, editor: false },
            { title: "Status", field: "item_status", editor: "select", editorParams: { values: ["lost", "found"] } },
            { title: "Lost Date", field: "lost_date", editor: "input" },
            { title: "Found Date", field: "found_date", editor: "input" },
            { title: "Location", field: "location", editor: "input" },
            { title: "Found Location", field: "found_location", editor: "input" },
            { title: "Description", field: "item_description", editor: "input" },
            {
                title: "Image",
                field: "image_url",
                formatter: "image",
                formatterParams: { height: "50px", width: "auto" },
            },
            { title: "Email", field: "email", editor: "input" },
            { title: "Grade and Section", field: "grade_and_section", editor: "input" },
            { title: "Phone Number", field: "phone_number", editor: "input" },

            
        ],
        cellEdited: (cell) => {
            const rowData = cell.getRow().getData();
            fetch("/update-table-data", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ data: rowData }),

            })
                .then((response) => response.json())
                .then((result) => {
                    if (result.success) {
                        console.log("Changes saved successfully!");
                    } else {
                        console.error("Error saving changes: " + result.error);
                    }
                })
                .catch((error) => console.error("Error:", error));
        },
    });

    // Function to mark an item as found
    function markAsFound(itemId) {
        fetch(`/mark-as-found/${itemId}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" }
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('Item marked as found successfully!');
                location.reload();  // Reload the page to reflect changes
            } else {
                alert('Error marking item as found: ' + result.error);
            }
        })
        .catch(error => console.error('Error:', error));
    }
});
</script>
{% endblock %}