{% extends "layout.html" %}
{% block title %}
    Admin Dashboard
{% endblock %}

{% block main %}
<div class="container mt-4">
    <h1 class="text-light">SHS Item Record</h1>
    <div class="search-bar-wrapper">
        <input id="search-input" type="text" placeholder="Search..." class="form-control search-bar mb-3">
    </div>
    <div id="table-container" class="table-responsive" style="width: 80vw; overflow-y: auto; margin-left: -5em;"></div> <!-- Div for Tabulator -->
</div>

<!-- Include Tabulator CDN -->
<link rel="stylesheet" href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css">
<script src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>

<!-- Custom CSS -->
<style>
    /* Modern green search bar styling */
    .search-bar-wrapper {
        width: 80vw;
        margin-left: -5em;
    }

    .search-bar {
        width: 100%;
        padding: 10px 15px;
        border: 2px solid #087830;
        border-radius: 25px;
        font-size: 16px;
        outline: none;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .search-bar:focus {
        border-color: #065a2b;
        box-shadow: 0 4px 10px rgba(0, 128, 0, 0.4);
    }

    .search-bar::placeholder {
        color: #6c757d;
        font-style: italic;
    }

    .tabulator .tabulator-tableHolder .tabulator-table {
        background-color: rgba(128, 128, 128, 0.5) !important; /* Transparent gray background */
        color: #000000 !important; /* Black text */
        font-weight: bold !important; /* Bold text */
    }

    .custom-green-btn {
        background-color: #087830;
        border-color: #087830;
        color: white;
    }

    .custom-green-btn:hover {
        background-color: #065a2b;
        border-color: #065a2b;
    }

    .custom-nav-link {
        color: #ffffff !important;
        position: relative;
        text-decoration: none;
        transition: color 0.2s ease-in-out;
    }

    .custom-nav-link::after {
        content: '';
        position: absolute;
        width: 0;
        height: 2px;
        display: block;
        margin-top: 5px;
        right: 0;
        background: #ffffff;
        transition: width 0.2s ease-in-out;
        -webkit-transition: width 0.2s ease-in-out;
    }

    .custom-nav-link:hover::after {
        width: 100%;
        left: 0;
        background: #ffffff;
    }

    .custom-nav-link:hover {
        color: #ffffff;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const tableData = JSON.parse(`{{ items | tojson | safe }}`); // Flask data

    const table = new Tabulator("#table-container", {
        data: tableData,
        layout: "fitColumns",
        columns: [
            { title: "ID", field: "id", width: 50 },
            { title: "Status", field: "item_status" },
            { title: "Lost Date", field: "lost_date" },
            { title: "Found Date", field: "found_date" },
            { title: "Lost Location", field: "location" },
            { title: "Found Location", field: "found_location" },
            { title: "Description", field: "item_description" },
            {
                title: "Image",
                field: "image_url",
                formatter: function(cell, formatterParams, onRendered) {
                    const value = cell.getValue();
                    return `<a href="${value}" target="_blank"><img src="${value}" style="height: 50px; width: auto;" /></a>`;
                }
            },
            { title: "Email", field: "email" },
            { title: "Grade and Section", field: "grade_and_section" },
            { title: "Phone Number", field: "phone_number" },
        ],
    });

    // Add event listener to the search input
    document.getElementById('search-input').addEventListener('input', function (e) {
        const value = e.target.value.toLowerCase(); // Convert search input to lowercase for case-insensitive matching
        table.setFilter(function (data) {
            // Check if any field contains the search value
            return Object.values(data).some(val =>
                String(val).toLowerCase().includes(value)
            );
        });
    });
});
</script>
{% endblock %}
