{% extends "layout.html" %} {% block title %}System Monitor{% endblock %} {%
block main %}
<div class="container mt-4">
  <h1 class="text-light mb-4">System Monitor</h1>

  <div class="d-flex flex-wrap justify-content-between gap-4">
    <!-- CPU Usage Card -->
    <div class="metric-card">
      <div class="card bg-dark text-light">
        <div class="card-body d-flex flex-column align-items-center">
          <h5 class="card-title">CPU Usage</h5>
          <p class="card-text display-4" id="cpu-usage">0%</p>
          <p class="card-text">Peak: <span id="cpu-peak">0%</span></p>
        </div>
      </div>
    </div>

    <!-- Memory Usage Card -->
    <div class="metric-card">
      <div class="card bg-dark text-light">
        <div class="card-body d-flex flex-column align-items-center">
          <h5 class="card-title">Memory Usage</h5>
          <p class="card-text display-4" id="memory-usage">0 MB</p>
          <p class="card-text">Peak: <span id="memory-peak">0 MB</span></p>
        </div>
      </div>
    </div>

    <!-- Disk I/O Card -->
    <div class="metric-card">
      <div class="card bg-dark text-light">
        <div class="card-body d-flex flex-column align-items-center">
          <h5 class="card-title">Disk I/O</h5>
          <p class="card-text display-4 mb-2">I/O Stats</p>
          <p class="card-text mb-1">Read: <span id="disk-read">0 MB</span></p>
          <p class="card-text">Write: <span id="disk-write">0 MB</span></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Performance Analysis -->
  <div class="card bg-dark text-light mt-4">
    <div class="card-body">
      <h5 class="card-title mb-4">Performance Analysis</h5>
      <div id="analysis-content" class="analysis-grid"></div>
    </div>
  </div>
</div>

<script>
  function updateElement(elementId, newValue) {
    const element = document.getElementById(elementId);
    element.textContent = newValue;
    element.classList.add("updated");
    setTimeout(() => element.classList.remove("updated"), 300);
  }

  function updateMetrics() {
    fetch("/system-metrics")
      .then((response) => response.json())
      .then((data) => {
        updateElement("cpu-usage", data.cpu_percent + "%");
        updateElement("cpu-peak", data.peak_metrics.cpu + "%");
        updateElement("memory-usage", Math.round(data.memory_rss) + " MB");
        updateElement(
          "memory-peak",
          Math.round(data.peak_metrics.memory) + " MB"
        );
        updateElement("disk-read", Math.round(data.disk_read_mb) + " MB");
        updateElement("disk-write", Math.round(data.disk_write_mb) + " MB");

        // Update analysis
        const analysis = data.analysis;
        if (analysis) {
          let analysisHtml = "";
          for (const [key, value] of Object.entries(analysis)) {
            if (typeof value === "object") {
              analysisHtml += `<h6 class="mt-3">${key}</h6>`;
              for (const [subKey, subValue] of Object.entries(value)) {
                analysisHtml += `<p>${subKey}: ${subValue}</p>`;
              }
            }
          }
          document.getElementById("analysis-content").innerHTML = analysisHtml;
        }
      });
  }

  // Update metrics every second
  setInterval(updateMetrics, 1000);
  updateMetrics(); // Initial update
</script>

<style>
  .container {
    
    border: 2px solid #86c232;
    border-radius: 10px;
    padding: 2rem;
    margin-top: 2rem;
  }

  .d-flex {
    position: relative;
    padding: 1rem;
    border: 1px solid #86c232;
    border-radius: 8px;
    background: rgba(6, 90, 43, 0.1);
  }

  .metric-card {
    flex: 1;
    min-width: 300px;
    max-width: 400px;
    position: relative;
  }

  .metric-card:not(:last-child)::after {
    content: "";
    position: absolute;
    right: -2rem;
    top: 10%;
    height: 80%;
    width: 2px;
    background: linear-gradient(to bottom, transparent, #86c232, transparent);
  }

  .card {
    border: 2px solid #86c232;
    background: rgba(0, 0, 0, 0.4);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    margin: 1rem;
    padding: 1rem;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(134, 194, 50, 0.2);
  }

  .card-body {
    position: relative;
    z-index: 1;
  }

  .card-title {
    color: #86c232;
    font-size: 1.25rem;
    font-weight: bold;
    text-align: center;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 2px solid #86c232;
    padding-bottom: 0.5rem;
  }

  .display-4 {
    color: #61892f;
    font-size: 2.5rem;
    font-weight: bold;
    text-align: center;
    margin: 1rem 0;
    text-shadow: 0 0 10px rgba(134, 194, 50, 0.3);
  }

  .card-text {
    color: #dddddd;
    font-size: 1.1rem;
    text-align: center;
    margin: 0.5rem 0;
  }

  /* Performance Analysis Section */
  .card.mt-4 {
    margin-top: 2rem !important;
    border: 2px solid #86c232;
    background: rgba(0, 0, 0, 0.4);
  }

  .analysis-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* Changed to 2 columns */
    gap: 2rem;
    padding: 1rem;
  }

  .analysis-grid h6 {
    grid-column: span 1; /* Each header spans 1 column */
    color: #86c232;
    font-size: 1.1rem;
    font-weight: bold;
    margin-bottom: 1rem;
    border-bottom: 2px solid #86c232;
    padding-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .analysis-grid p {
    color: #dddddd;
    margin-bottom: 1rem;
    padding: 0.75rem;
    background: rgba(6, 90, 43, 0.1);
    border-left: 3px solid #86c232;
    border-radius: 0 4px 4px 0;
  }

  /* Update Animation */
  .updated {
    animation: glow 0.3s ease-in-out;
  }

  @keyframes glow {
    0% {
      text-shadow: 0 0 5px rgba(134, 194, 50, 0.5);
    }
    50% {
      text-shadow: 0 0 20px rgba(134, 194, 50, 0.8);
    }
    100% {
      text-shadow: 0 0 5px rgba(134, 194, 50, 0.5);
    }
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .metric-card:not(:last-child)::after {
      display: none;
    }

    .metric-card {
      border-bottom: 1px solid #86c232;
      padding-bottom: 1rem;
      margin-bottom: 1rem;
    }

    .metric-card:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
  }

  @media (max-width: 768px) {
    .metric-card {
      min-width: 100%;
    }

    .display-4 {
      font-size: 2rem;
    }

    .container {
      padding: 1rem;
    }
  }
</style>
{% endblock %}
